<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foodybank - Onboarding</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 375px;
            margin: 0 auto;
            background: #fff;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* Onboarding Screens */
        .onboarding-screen {
            display: none;
            min-height: 100vh;
            padding: 40px 30px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
        }

        .onboarding-screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .onboarding-icon {
            font-size: 80px;
            margin-bottom: 30px;
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .onboarding-title {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .onboarding-subtitle {
            font-size: 16px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 40px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            font-size: 16px;
            transition: transform 0.2s;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 12px 30px;
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            transition: background 0.2s;
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        /* Choice Options Screen */
        .choice-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        .choice-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .choice-card:hover {
            border-color: #4CAF50;
            background: #f8fff8;
            transform: translateX(5px);
        }

        .choice-icon {
            font-size: 32px;
        }

        .choice-text {
            text-align: left;
            font-weight: 600;
            color: #333;
        }

        .choice-hint {
            font-size: 12px;
            color: #999;
            margin-top: 20px;
        }

        /* Camera Screen */
        .camera-container {
            width: 100%;
            max-width: 300px;
            height: 300px;
            background: #f0f0f0;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            border: 3px dashed #4CAF50;
            position: relative;
            overflow: hidden;
        }

        .camera-placeholder {
            text-align: center;
            color: #999;
        }

        .camera-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .photo-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .capture-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: white;
            border: 5px solid #4CAF50;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .capture-btn:hover {
            transform: scale(1.1);
        }

        /* Processing Animation */
        .processing {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Products List */
        .products-list {
            width: 100%;
            max-width: 300px;
            background: #f8fff8;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .product-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
            font-size: 16px;
        }

        .product-item:last-child {
            border-bottom: none;
        }

        .product-emoji {
            font-size: 24px;
        }

        .product-count {
            background: #E8F5E9;
            color: #2E7D32;
            padding: 6px 14px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 20px;
            border: 1px solid #C8E6C9;
        }

        .points-badge {
            background: #FFF9E6;
            color: #F57C00;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: bold;
            margin: 20px 0;
            display: inline-block;
            animation: pulse 0.5s ease-in-out;
            border: 2px solid #FFE0B2;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Benefits List */
        .benefits-list {
            text-align: left;
            margin: 20px 0;
            max-width: 300px;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            font-size: 16px;
            color: #333;
        }

        .benefit-icon {
            font-size: 20px;
        }

        /* Auth Buttons */
        .auth-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 300px;
        }

        .auth-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid #e0e0e0;
            background: white;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
        }

        .auth-btn-email {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
        }

        .auth-btn-apple {
            background: #000;
            color: white;
            border: none;
        }

        .skip-link {
            margin-top: 20px;
            color: #999;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
        }

        .skip-link:hover {
            color: #666;
        }

        /* Warning Box */
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            max-width: 300px;
        }

        .warning-text {
            color: #856404;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Main App (from previous prototype) */
        .main-app {
            display: none;
        }

        .main-app.active {
            display: block;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
        }

        .streak-badge {
            background: rgba(255,255,255,0.15);
            padding: 8px 12px;
            border-radius: 20px;
            margin: 10px 0;
            display: inline-block;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .points-level {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .points {
            font-size: 14px;
        }

        .level {
            background: rgba(255,255,255,0.3);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .main-content {
            padding: 20px;
            padding-bottom: 100px;
        }

        .mission-card {
            background: #fff;
            border: 2px solid #4CAF50;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.1);
        }

        .mission-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .mission-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .mission-title {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
        }

        .mission-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .alert-card {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .alert-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .alert-icon {
            margin-right: 8px;
        }

        .food-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .food-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
        }

        .food-emoji {
            margin-right: 10px;
            font-size: 18px;
        }

        .stats-card {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stats-title {
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 16px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 375px;
            width: 100%;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: around;
            padding: 10px 0;
            z-index: 100;
        }

        .tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            text-decoration: none;
            color: #999;
            font-size: 12px;
            flex: 1;
            transition: color 0.2s;
        }

        .tab.active {
            color: #4CAF50;
        }

        .tab-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .hidden {
            display: none !important;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            max-width: 320px;
            width: 90%;
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .modal-text {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .points-earned {
            background: #FFF9E6;
            color: #F57C00;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin: 15px 0;
            display: inline-block;
            border: 2px solid #FFE0B2;
            font-size: 18px;
        }

        .photo-upload {
            border: 2px dashed #4CAF50;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            margin: 15px 0;
            transition: background 0.2s;
        }

        .photo-upload:hover {
            background: #f8fff8;
        }

        .photo-upload input {
            display: none;
        }

        .recipe-grid {
            display: grid;
            gap: 15px;
            margin: 15px 0;
        }

        .recipe-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .recipe-card:hover, .recipe-card.selected {
            border-color: #4CAF50;
            background: #f8fff8;
        }

        .recipe-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .recipe-ingredients {
            color: #666;
            font-size: 14px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .ad-banner {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #333;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            position: relative;
        }

        .ad-skip {
            position: absolute;
            top: 5px;
            right: 10px;
            background: rgba(0,0,0,0.2);
            color: white;
            border: none;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .success-animation {
            animation: bounceAnim 0.6s ease-out;
        }

        @keyframes bounceAnim {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }

        /* HYBRID MODEL - NEW STYLES */

        /* Header Fisso */
        .header-fixed {
            position: sticky;
            top: 0;
            background: white;
            padding: 12px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 90;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .streak-info {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        .points-info {
            font-size: 14px;
            color: #666;
        }

        /* Mission Suggerita */
        .mission-suggested {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFE5B4 100%);
            border: 3px solid #FFD700;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .mission-suggested:hover {
            transform: translateY(-2px);
        }

        .suggested-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }

        .mission-reward-inline {
            color: #4CAF50;
            font-weight: bold;
            font-size: 14px;
        }

        /* Products Pills */
        .products-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }

        .product-pill {
            background: #FFF3E0;
            border: 1px solid #FFB74D;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
            color: #E65100;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-remove-pill {
            background: none;
            border: none;
            color: #E65100;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            transition: transform 0.2s;
        }

        .btn-remove-pill:hover {
            transform: scale(1.2);
        }

        /* Section Title */
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        /* Altre Missioni */
        .other-missions {
            margin: 20px 0;
        }

        .mission-card-small {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 44px;
        }

        .mission-card-small:hover {
            border-color: #4CAF50;
            background: #f8fff8;
            transform: translateX(4px);
        }

        .mission-card-small:active {
            transform: scale(0.98);
        }

        .mission-emoji {
            font-size: 28px;
        }

        .mission-name {
            flex: 1;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .mission-points {
            font-size: 14px;
            font-weight: bold;
            color: #4CAF50;
        }

        /* Daily Stats */
        .daily-stats {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
            text-align: center;
        }

        .stats-title-small {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
        }

        .stats-row {
            display: flex;
            justify-content: center;
            gap: 24px;
        }

        .stat-item-small {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        /* Placeholder Screens */
        .placeholder-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .placeholder-content {
            max-width: 320px;
            text-align: center;
            padding: 30px;
        }

        .placeholder-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .placeholder-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
        }

        .placeholder-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }

        .placeholder-desc {
            font-size: 14px;
            color: #999;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        /* Responsive & Touch Targets */
        @media (min-width: 320px) {
            .mission-card-small,
            .btn-primary,
            .btn-secondary {
                min-height: 44px;
            }
        }

        /* Main content padding for fixed header */
        .main-app .main-content {
            padding-top: 20px;
            padding-bottom: 100px;
        }

        /* NEW REORGANIZATION STYLES */

        /* Screen management */
        .screen {
            display: block;
        }

        .screen.hidden {
            display: none !important;
        }

        /* Home - Mission Suggerita Main */
        .mission-suggested-main {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFFFFF 100%);
            border: 2px solid #FFD700;
            border-radius: 16px;
            padding: 24px;
            margin: 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
        }

        .badge-main {
            font-size: 11px;
            color: #F57C00;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        .emoji-large {
            font-size: 64px;
            margin: 16px 0;
        }

        .mission-title-main {
            font-size: 24px;
            font-weight: bold;
            margin: 12px 0;
            color: #333;
        }

        .mission-desc-main {
            font-size: 16px;
            color: #666;
            margin: 12px 0 20px;
            line-height: 1.4;
        }

        .btn-primary-large {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            max-width: 300px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-primary-large:hover {
            background: #45a049;
        }

        /* Missioni Screen */
        .missions-header {
            text-align: center;
            padding: 16px 20px 12px;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .mission-featured {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFFFFF 100%);
            border: 2px solid #FFD700;
            border-radius: 16px;
            padding: 20px;
            margin: 16px;
        }

        .featured-badge {
            font-size: 11px;
            color: #F57C00;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        .featured-content {
            text-align: center;
        }

        .featured-icon {
            font-size: 48px;
            margin: 8px 0;
        }

        .featured-content h3 {
            font-size: 20px;
            margin: 8px 0;
        }

        .featured-points {
            font-size: 16px;
            font-weight: bold;
            color: #4CAF50;
            margin: 8px 0;
        }

        .breakdown {
            font-size: 13px;
            color: #666;
            font-weight: normal;
        }

        .featured-time {
            font-size: 14px;
            color: #666;
            margin: 8px 0 16px;
        }

        .section-header {
            padding: 20px 16px 12px;
        }

        .section-header h3 {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }

        .mission-card-compact {
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            padding: 16px;
            margin: 8px 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mission-card-compact:hover {
            border-color: #4CAF50;
            background: #f8fff8;
        }

        .compact-icon {
            font-size: 32px;
            margin-right: 12px;
        }

        .compact-info {
            flex: 1;
        }

        .compact-info h4 {
            font-size: 16px;
            font-weight: bold;
            margin: 0 0 4px 0;
        }

        .compact-meta {
            font-size: 13px;
            color: #666;
            margin: 0;
        }

        .btn-compact {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
        }

        /* Custom Recipe Screen */
        .screen-header {
            padding: 16px;
            border-bottom: 1px solid #E0E0E0;
            background: white;
        }

        .btn-back {
            background: none;
            border: none;
            color: #4CAF50;
            font-size: 16px;
            cursor: pointer;
            padding: 8px 0;
            font-weight: 600;
        }

        .screen-header h2 {
            font-size: 20px;
            font-weight: bold;
            margin: 8px 0;
        }

        .custom-recipe-content {
            padding: 16px;
        }

        .quick-picks {
            margin-bottom: 24px;
        }

        .label {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
        }

        .quick-picks-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .quick-picks-grid button {
            background: #F5F5F5;
            border: 1px solid #DDD;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            transition: background 0.2s;
        }

        .quick-picks-grid button:hover {
            background: #EFEFEF;
        }

        .input-container {
            margin: 16px 0;
        }

        #custom-recipe-input {
            width: 100%;
            border: 1px solid #DDD;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            font-family: inherit;
            resize: none;
        }

        .hint {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-skip {
            background: none;
            border: 1px solid #DDD;
            color: #666;
            border-radius: 12px;
            padding: 12px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-skip:hover {
            background: #F5F5F5;
        }

        /* Custom option in modal */
        .custom-option-modal {
            margin: 16px 0;
            text-align: center;
        }

        .btn-secondary-custom {
            background: #F5F5F5;
            color: #333;
            border: 1px solid #DDD;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            transition: background 0.2s;
        }

        .btn-secondary-custom:hover {
            background: #EFEFEF;
        }

        /* Button Link Style - Secondary Pill */
        .btn-link {
            background: white;
            border: 1px solid #E0E0E0;
            color: #4CAF50;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 10px 20px;
            text-align: center;
            border-radius: 20px;
            width: auto;
            display: block;
            margin: 12px auto 0;
            transition: background 0.2s;
        }

        .btn-link:hover {
            background: #F5F5F5;
        }

        /* SPESA SCREEN STYLES */
        .spesa-header {
            text-align: center;
            padding: 16px 20px 12px;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .spesa-content {
            padding: 16px;
            padding-bottom: 100px; /* Space for tab-bar */
        }

        .spesa-intro {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .shopping-list {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .shopping-item {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid #E0E0E0;
        }

        .shopping-item:last-child {
            border-bottom: none;
        }

        .shopping-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: #4CAF50;
        }

        .shopping-item-content {
            flex: 1;
        }

        .shopping-item-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .shopping-item-note {
            font-size: 13px;
            color: #999;
            font-style: italic;
        }

        .shopping-item.checked .shopping-item-name {
            text-decoration: line-through;
            color: #999;
        }

        .btn-remove-item {
            background: none;
            border: none;
            color: #999;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            margin-left: 8px;
            line-height: 1;
            transition: color 0.2s;
        }

        .btn-remove-item:hover {
            color: #E53935;
        }

        .shopping-cta {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .shopping-cta:hover {
            transform: translateY(-2px);
        }

        /* Add Product Button */
        .add-product-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            background: #F5F5F5;
            border: 2px dashed #4CAF50;
            border-radius: 8px;
            margin-top: 8px;
            cursor: pointer;
            color: #4CAF50;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .add-product-btn:hover {
            background: #E8F5E9;
        }

        /* Add Product Modal */
        .add-product-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .add-product-modal.active {
            display: flex;
        }

        .add-product-content {
            background: white;
            max-width: 340px;
            width: 90%;
            border-radius: 15px;
            padding: 24px 20px;
            animation: modalSlide 0.3s ease-out;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header-custom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title-custom {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .btn-close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .quick-picks-section {
            margin-bottom: 24px;
        }

        .section-label {
            font-size: 14px;
            font-weight: 600;
            color: #666;
            margin-bottom: 12px;
        }

        .quick-picks-grid-modal {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .quick-pick-btn {
            background: #F5F5F5;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .quick-pick-btn:hover {
            background: #E8F5E9;
            border-color: #4CAF50;
        }

        .quick-pick-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 4px;
        }

        .custom-input-section {
            margin-bottom: 20px;
        }

        .input-wrapper {
            display: flex;
            gap: 8px;
        }

        .custom-product-input {
            flex: 1;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
            font-family: inherit;
        }

        .custom-product-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .btn-add-custom {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .btn-add-custom:hover {
            background: #45a049;
        }

        /* SPESA SMART STYLES */
        .spesa-smart-screen {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 375px;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 300;
            display: none;
            flex-direction: column;
        }

        .spesa-smart-screen.active {
            display: flex;
        }

        .spesa-smart-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .spesa-smart-header h2 {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .spesa-smart-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .spesa-smart-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .upload-intro {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-bottom: 20px;
        }

        .upload-area {
            background: #F5F5F5;
            border: 2px dashed #4CAF50;
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            margin: 20px 0;
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 8px;
        }

        .btn-upload {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-upload:hover {
            transform: translateY(-2px);
            transition: transform 0.2s;
        }

        /* Receipt Display */
        .receipt-container {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
            text-align: center;
        }

        .receipt-header {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .receipt-address {
            color: #666;
            font-size: 11px;
            margin-bottom: 4px;
        }

        .receipt-date {
            color: #666;
            font-size: 11px;
            margin-bottom: 16px;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
        }

        .receipt-divider {
            border-top: 1px dashed #999;
            margin: 12px 0;
        }

        .receipt-total {
            font-weight: bold;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }

        .receipt-footer {
            color: #666;
            font-size: 11px;
            margin-top: 12px;
        }

        /* Processing Screen */
        .processing-container {
            text-align: center;
            padding: 40px 20px;
        }

        .processing-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .processing-steps {
            text-align: left;
            max-width: 300px;
            margin: 30px auto;
        }

        .processing-step {
            font-size: 14px;
            color: #666;
            margin: 12px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .processing-step.completed {
            color: #4CAF50;
        }

        .processing-step.loading {
            color: #999;
        }

        /* Result Screen */
        .result-container {
            text-align: center;
            padding: 40px 20px;
        }

        .result-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 20px;
        }

        .result-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }

        .result-products {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-product-item {
            font-size: 16px;
            color: #333;
            margin: 12px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .result-points {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            border-radius: 12px;
            padding: 16px;
            font-size: 20px;
            font-weight: bold;
            margin-top: 20px;
        }

        /* PROFILO SCREEN STYLES */
        .profilo-content {
            padding: 16px;
            padding-bottom: 100px;
        }

        .profile-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 16px;
            text-align: center;
        }

        .profile-stat {
            font-size: 16px;
            margin: 8px 0;
            font-weight: 600;
        }

        .context-card {
            background: white;
            border: 2px solid #E0E0E0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .context-card.default {
            border-color: #FFB74D;
            background: #FFF9E6;
        }

        .context-header {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-warning {
            background: #FFF3E0;
            border: 1px solid #FFB74D;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            color: #E65100;
            font-size: 14px;
            font-weight: 600;
        }

        .context-list {
            margin: 16px 0;
        }

        .context-item {
            font-size: 14px;
            color: #666;
            margin: 8px 0;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .context-footer {
            font-size: 13px;
            color: #999;
            margin-top: 16px;
            font-style: italic;
        }

        .btn-customize {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            margin: 16px 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            50% { box-shadow: 0 0 20px 10px rgba(76, 175, 80, 0); }
        }

        .btn-customize:hover {
            transform: translateY(-2px);
            transition: transform 0.2s;
        }

        .settings-card {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            padding: 20px;
        }

        .settings-header {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #F5F5F5;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 14px;
            color: #333;
        }

        .setting-value {
            font-size: 14px;
            color: #666;
            font-weight: 600;
        }

        /* Fullscreen Context Modal */
        .context-fullscreen {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 375px;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 300;
            display: none;
            flex-direction: column;
        }

        .context-fullscreen.active {
            display: flex;
        }

        .context-fs-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .context-fs-header h2 {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-fs-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .context-fs-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .context-intro {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .context-example {
            background: #F5F5F5;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            font-size: 13px;
            color: #666;
            font-style: italic;
        }

        .context-textarea {
            width: 100%;
            min-height: 150px;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 16px;
        }

        .context-textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .context-ai-note {
            background: #E8F5E9;
            border-radius: 8px;
            padding: 12px;
            font-size: 13px;
            color: #2E7D32;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .context-actions {
            display: flex;
            gap: 12px;
            padding: 16px 20px;
            background: white;
            border-top: 1px solid #E0E0E0;
        }

        .btn-save {
            flex: 1;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-cancel {
            flex: 1;
            background: white;
            color: #666;
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Confirmation Modal */
        .context-confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .context-confirm-modal.active {
            display: flex;
        }

        .context-confirm-content {
            background: white;
            max-width: 320px;
            width: 90%;
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            animation: modalSlide 0.3s ease-out;
        }

        .confirm-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .confirm-title {
            font-size: 20px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 16px;
        }

        .confirm-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
        }

        .confirm-list {
            text-align: left;
            margin: 16px 0;
        }

        .confirm-list-item {
            font-size: 14px;
            color: #333;
            margin: 8px 0;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .confirm-message {
            font-size: 14px;
            color: #666;
            margin: 16px 0;
            line-height: 1.5;
        }

        /* STATS FULL SCREEN STYLES */
        .stats-full-screen {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 375px;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 300;
            display: none;
            flex-direction: column;
        }

        .stats-full-screen.active {
            display: flex;
        }

        .stats-full-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stats-full-header .btn-back {
            background: white;
            border: 1px solid #E0E0E0;
            color: #4CAF50;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 20px;
            transition: background 0.2s;
        }

        .stats-full-header .btn-back:hover {
            background: #F5F5F5;
        }

        .stats-full-header h2 {
            font-size: 20px;
            font-weight: bold;
            margin: 0;
            flex: 1;
        }

        .stats-tabs {
            display: flex;
            background: #F5F5F5;
            border-bottom: 1px solid #E0E0E0;
        }

        .stats-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            position: relative;
            transition: color 0.2s;
        }

        .stats-tab.active {
            color: #4CAF50;
        }

        .stats-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #4CAF50;
        }

        .stats-full-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .stats-tab-content {
            display: none;
        }

        .stats-tab-content.active {
            display: block;
        }

        .stat-card-full {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .stat-card-full h3 {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin: 0 0 16px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #F5F5F5;
        }

        .stat-detail-row:last-child {
            border-bottom: none;
        }

        .stat-detail-label {
            font-size: 14px;
            color: #666;
        }

        .stat-detail-value {
            font-size: 16px;
            font-weight: bold;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- SCREEN 1: Hook Emotivo -->
        <div class="onboarding-screen active" id="screen1">
            <div class="onboarding-icon"></div>
            <h1 class="onboarding-title">Quante cose butti perch te ne dimentichi?</h1>
            <p class="onboarding-subtitle">Foodybank ti aiuta a usare quello che hai prima che sia troppo tardi</p>
            <button class="btn-primary" onclick="nextScreen(2)">Continua </button>
        </div>

        <!-- SCREEN 2: Rimozione Paura -->
        <div class="onboarding-screen" id="screen2">
            <div class="onboarding-icon"></div>
            <h1 class="onboarding-title">Non devi inserire tutto</h1>
            <p class="onboarding-subtitle">Niente liste infinite. Niente lavoro noioso. Puoi iniziare con una sola azione.</p>
            <button class="btn-primary" onclick="nextScreen(3)">Ok, fammi vedere </button>
        </div>

        <!-- SCREEN 3: Scelta Pigra -->
        <div class="onboarding-screen" id="screen3">
            <h1 class="onboarding-title">Come vuoi iniziare?</h1>
            <div class="choice-options">
                <div class="choice-card" onclick="selectChoice('photo')">
                    <div class="choice-icon"></div>
                    <div class="choice-text">Scatta una foto al frigo</div>
                </div>
                <div class="choice-card" onclick="selectChoice('receipt')">
                    <div class="choice-icon"></div>
                    <div class="choice-text">Carica uno scontrino</div>
                </div>
                <div class="choice-card" onclick="selectChoice('voice')">
                    <div class="choice-icon"></div>
                    <div class="choice-text">Dimmi cosa hai comprato</div>
                </div>
            </div>
            <p class="choice-hint"> Bastano 10 secondi</p>
        </div>

        <!-- SCREEN 4: Camera / Action -->
        <div class="onboarding-screen" id="screen4">
            <h1 class="onboarding-title">Scatta una foto</h1>
            <div class="camera-container" id="cameraView">
                <div class="camera-placeholder">
                    <div class="camera-icon"></div>
                    <div>Inquadra il tuo frigo</div>
                </div>
            </div>
            <div class="capture-btn" onclick="capturePhoto()"></div>
        </div>

        <!-- SCREEN 4b: Processing -->
        <div class="onboarding-screen" id="screen4b">
            <div class="processing">
                <div class="spinner"></div>
                <p class="onboarding-subtitle"> Riconosciamo i prodotti...</p>
            </div>
        </div>

        <!-- SCREEN 5: Risultato + Prodotti -->
        <div class="onboarding-screen" id="screen5">
            <div class="onboarding-icon"></div>
            <h1 class="onboarding-title">Riconoscimento completato!</h1>
            <p class="onboarding-subtitle">Ecco cosa hai:</p>
            
            <div class="products-list">
                <div class="product-item">
                    <span class="product-emoji"></span>
                    <span>Latte</span>
                </div>
                <div class="product-item">
                    <span class="product-emoji"></span>
                    <span>Uova</span>
                </div>
                <div class="product-item">
                    <span class="product-emoji"></span>
                    <span>Pomodori</span>
                </div>
                <div class="product-item">
                    <span class="product-emoji"></span>
                    <span>Mozzarella</span>
                </div>
                <div class="product-item">
                    <span class="product-emoji"></span>
                    <span>Pasta</span>
                </div>
            </div>

            <div class="product-count">5 prodotti riconosciuti</div>
            
            <div class="points-badge">+25 punti! </div>
            
            <button class="btn-primary" onclick="nextScreen(6)">Salva e continua </button>
        </div>

        <!-- SCREEN 6: Registration -->
        <div class="onboarding-screen" id="screen6">
            <div class="onboarding-icon"></div>
            <h1 class="onboarding-title">Ottimo inizio!</h1>
            
            <div class="benefits-list">
                <div class="benefit-item">
                    <span class="benefit-icon"></span>
                    <span>25 punti</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon"></span>
                    <span>5 prodotti tracciati</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon"></span>
                    <span>La tua prima mission ti aspetta</span>
                </div>
            </div>

            <div class="warning-box">
                <p class="warning-text"> Devi creare un account per continuare</p>
            </div>

            <div class="auth-buttons">
                <div class="auth-btn auth-btn-email" onclick="createAccount('email')">
                     Continua con Email
                </div>
                <div class="auth-btn auth-btn-apple" onclick="createAccount('apple')">
                     Continua con Apple
                </div>
                <div class="auth-btn" onclick="createAccount('google')">
                    <span style="color: #4285F4;">G</span> Continua con Google
                </div>
            </div>

        </div>

        <!-- SCREEN 7: Notifiche -->
        <div class="onboarding-screen" id="screen7">
            <div class="onboarding-icon"></div>
            <h1 class="onboarding-title">Un'ultima cosa importante</h1>
            <p class="onboarding-subtitle" style="font-weight: 600;">Il segreto  lo STREAK</p>
            
            <div class="benefits-list">
                <div class="benefit-item">
                    <span class="benefit-icon"></span>
                    <span>Una notifica al giorno ti ricorda la mission (30 secondi)</span>
                </div>
            </div>

            <div class="warning-box">
                <p class="warning-text">Senza notifiche = Dimentichi = Perdi lo streak</p>
            </div>

            <button class="btn-primary" onclick="enableNotifications()"> Attiva notifiche</button>
        </div>

        <!-- MAIN APP (from previous prototype) -->
        <div class="main-app" id="mainApp">
            <!-- Header Originale -->
            <div class="header">
                <h1> Foodybank</h1>
                <div class="streak-badge" id="streakBadge">
                     Streak: <span id="streakCount">1</span> giorni
                </div>
                <div class="points-level">
                    <div class="points"> <span id="pointsCount">30</span> punti</div>
                    <div class="level" id="userLevel">Novizio</div>
                </div>
            </div>

            <!-- HOME SCREEN -->
            <div id="home-screen" class="screen">
                <div class="main-content">
                    <!-- MISSION SUGGERITA UNICA -->
                    <div class="mission-suggested-main">
                        <div class="badge-main"> MISSIONE DI OGGI</div>
                        <div class="emoji-large"></div>
                        <h2 class="mission-title-main">Chef di oggi</h2>
                        <p class="mission-desc-main">Hai 5 ingredienti!<br>Ti suggeriamo 3 ricette</p>
                        <button class="btn-primary-large" onclick="startChefMission()">
                            INIZIA  +40pt
                        </button>
                    </div>

                    <!-- DA USARE PRIMA -->
                    <div class="alert-card">
                        <div class="alert-title">
                            <span class="alert-icon"></span>
                            DA USARE PRIMA
                        </div>
                        <div class="products-pills">
                            <span class="product-pill">
                                 Mozzarella
                                <button class="btn-remove-pill" onclick="openZeroSprecoForProduct('Mozzarella', '')"></button>
                            </span>
                            <span class="product-pill">
                                 Pomodori
                                <button class="btn-remove-pill" onclick="openZeroSprecoForProduct('Pomodori', '')"></button>
                            </span>
                            <span class="product-pill">
                                 Latte
                                <button class="btn-remove-pill" onclick="openZeroSprecoForProduct('Latte', '')"></button>
                            </span>
                        </div>
                        <button class="btn-secondary" onclick="suggestRecipe()">COSA CUCINO?</button>
                    </div>

                    <!-- STATS COMPLETE (footer) -->
                    <div class="stats-card">
                        <div class="stats-title">
                            <span style="margin-right: 8px;"></span>
                            I TUOI NUMERI
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value"> 0.2kg</div>
                                <div class="stat-label">CO2 salvata</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value"> 5</div>
                                <div class="stat-label">Risparmiati</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value"> 0</div>
                                <div class="stat-label">Ricette</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value"> 1</div>
                                <div class="stat-label">Giorni streak</div>
                            </div>
                        </div>
                        <button class="btn-link" onclick="showFullStats()">
                            Vedi dettagli 
                        </button>
                    </div>
                </div>
            </div>

            <!-- MISSIONI SCREEN -->
            <div id="missioni-screen" class="screen hidden">
                <div class="missions-header">
                    <h2> Missioni</h2>
                </div>

                <!-- Mission suggerita ripetuta con pi info -->
                <div class="mission-featured">
                    <div class="featured-badge"> SUGGERITA OGGI</div>
                    <div class="featured-content">
                        <div class="featured-icon"></div>
                        <h3>Chef di oggi</h3>
                        <p class="featured-points">+40pt <span class="breakdown">(30 base + 10 bonus)</span></p>
                        <p class="featured-time"> ~5 minuti</p>
                    </div>
                    <button class="btn-primary" onclick="startChefMission()">INIZIA </button>
                </div>

                <!-- Separatore -->
                <div class="section-header">
                    <h3> TUTTE LE MISSIONI</h3>
                </div>

                <!-- Mission compatte -->
                <div class="mission-card-compact" onclick="showModal('photoMissionModal')">
                    <div class="compact-icon"></div>
                    <div class="compact-info">
                        <h4>Scatta & Scopri</h4>
                        <p class="compact-meta">+20pt   1 min</p>
                    </div>
                    <button class="btn-compact">VAI </button>
                </div>

                <div class="mission-card-compact" onclick="openSpesaSmartMission()">
                    <div class="compact-icon"></div>
                    <div class="compact-info">
                        <h4>Spesa Smart</h4>
                        <p class="compact-meta">+25pt   2 min</p>
                    </div>
                    <button class="btn-compact">VAI </button>
                </div>

                <div class="mission-card-compact" onclick="showModal('zeroWasteModal')">
                    <div class="compact-icon"></div>
                    <div class="compact-info">
                        <h4>Zero Spreco</h4>
                        <p class="compact-meta">+10pt   30 sec</p>
                    </div>
                    <button class="btn-compact">VAI </button>
                </div>

                <div class="mission-card-compact" onclick="showPlaceholder('frigo')">
                    <div class="compact-icon"></div>
                    <div class="compact-info">
                        <h4>Frigo Check</h4>
                        <p class="compact-meta">+5pt   20 sec</p>
                    </div>
                    <button class="btn-compact">VAI </button>
                </div>
            </div>

            <!-- SPESA SCREEN -->
            <div id="spesa-screen" class="screen hidden">
                <div class="spesa-header">
                    <h2> Lista della spesa</h2>
                </div>

                <div class="spesa-content">
                    <p class="spesa-intro">
                         Ti suggeriamo cosa comprare in base a ci che usi pi spesso e cosa sta per finire.
                    </p>

                    <div class="shopping-list">
                        <div class="shopping-item">
                            <input type="checkbox" class="shopping-checkbox" onchange="toggleShoppingItem(this)">
                            <div class="shopping-item-content">
                                <div class="shopping-item-name"> Latte</div>
                                <div class="shopping-item-note">Finito ieri</div>
                            </div>
                            <button class="btn-remove-item" onclick="removeFromShoppingList(this)"></button>
                        </div>

                        <div class="shopping-item">
                            <input type="checkbox" class="shopping-checkbox" onchange="toggleShoppingItem(this)">
                            <div class="shopping-item-content">
                                <div class="shopping-item-name"> Pomodori</div>
                                <div class="shopping-item-note">Usati 3x questa settimana</div>
                            </div>
                            <button class="btn-remove-item" onclick="removeFromShoppingList(this)"></button>
                        </div>

                        <div class="shopping-item">
                            <input type="checkbox" class="shopping-checkbox" onchange="toggleShoppingItem(this)">
                            <div class="shopping-item-content">
                                <div class="shopping-item-name"> Uova</div>
                                <div class="shopping-item-note">Ne restano solo 2</div>
                            </div>
                            <button class="btn-remove-item" onclick="removeFromShoppingList(this)"></button>
                        </div>

                        <div class="shopping-item">
                            <input type="checkbox" class="shopping-checkbox" onchange="toggleShoppingItem(this)">
                            <div class="shopping-item-content">
                                <div class="shopping-item-name"> Pasta</div>
                                <div class="shopping-item-note">Ingrediente preferito</div>
                            </div>
                            <button class="btn-remove-item" onclick="removeFromShoppingList(this)"></button>
                        </div>

                        <div class="shopping-item">
                            <input type="checkbox" class="shopping-checkbox" onchange="toggleShoppingItem(this)">
                            <div class="shopping-item-content">
                                <div class="shopping-item-name"> Mozzarella</div>
                                <div class="shopping-item-note">Comprata 2 settimane fa</div>
                            </div>
                            <button class="btn-remove-item" onclick="removeFromShoppingList(this)"></button>
                        </div>

                        <!-- Add Product Button -->
                        <button class="add-product-btn" onclick="openAddProductModal()">
                            + Aggiungi prodotto
                        </button>
                    </div>

                    <button class="shopping-cta" onclick="openSpesaSmartMission()">
                        HAI FATTO LA SPESA? 
                    </button>
                </div>
            </div>

            <!-- PROFILO SCREEN -->
            <div id="profilo-screen" class="screen hidden">
                <div class="profilo-content">
                    <!-- Profile Header -->
                    <div class="profile-header">
                        <div class="profile-stat"> Streak: 12 giorni</div>
                        <div class="profile-stat"> Livello: Cuoco (340 punti)</div>
                    </div>

                    <!-- Context Card - Default State -->
                    <div class="context-card default" id="contextCard">
                        <div class="context-header">
                             IL TUO CONTESTO
                        </div>

                        <div class="context-warning">
                             Stiamo usando impostazioni predefinite:
                        </div>

                        <div class="context-list">
                            <div class="context-item"> Nessuna restrizione alimentare</div>
                            <div class="context-item"> Nessuna allergia</div>
                            <div class="context-item"> Cucini quando vuoi</div>
                            <div class="context-item"> Ricette per 1-2 persone</div>
                        </div>

                        <button class="btn-customize" onclick="openContextModal()">
                             PERSONALIZZA
                        </button>

                        <div class="context-footer">
                            Non  giusto per te?<br>
                            Aiutaci a conoscerti meglio!
                        </div>
                    </div>

                    <!-- Settings Card -->
                    <div class="settings-card">
                        <div class="settings-header">
                             IMPOSTAZIONI
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">Notifiche</span>
                            <span class="setting-value">ON</span>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">Lingua</span>
                            <span class="setting-value">Italiano</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Bar -->
            <div class="tab-bar">
                <a href="#" class="tab active" data-tab="home" onclick="event.preventDefault(); navigateTo('home')">
                    <div class="tab-icon"></div>
                    Home
                </a>
                <a href="#" class="tab" data-tab="missioni" onclick="event.preventDefault(); navigateTo('missioni')">
                    <div class="tab-icon"></div>
                    Missioni
                </a>
                <a href="#" class="tab" data-tab="spesa" onclick="event.preventDefault(); navigateTo('spesa')">
                    <div class="tab-icon"></div>
                    Spesa
                </a>
                <a href="#" class="tab" data-tab="profilo" onclick="event.preventDefault(); navigateTo('profilo')">
                    <div class="tab-icon"></div>
                    Profilo
                </a>
            </div>
        </div>

        <!-- CUSTOM RECIPE SCREEN (nuovo) -->
        <div id="custom-recipe-screen" class="screen hidden">
            <div class="screen-header">
                <button class="btn-back" onclick="goBackToChef()"> Indietro</button>
                <h2> Cosa hai cucinato?</h2>
            </div>

            <div class="custom-recipe-content">
                <!-- Quick picks -->
                <div class="quick-picks">
                    <p class="label">Ricette comuni:</p>
                    <div class="quick-picks-grid">
                        <button onclick="selectQuickRecipe('Risotto')"> Risotto</button>
                        <button onclick="selectQuickRecipe('Carbonara')"> Carbonara</button>
                        <button onclick="selectQuickRecipe('Pizza')"> Pizza</button>
                        <button onclick="selectQuickRecipe('Aglio e olio')"> Aglio e olio</button>
                    </div>
                </div>

                <p class="divider">oppure scrivi</p>

                <!-- Free input -->
                <div class="input-container">
                    <textarea id="custom-recipe-input" placeholder="Es: Risotto allo zafferano" maxlength="100" rows="3"></textarea>
                    <p class="hint"> Scrivi cosa hai cucinato. Ci occupiamo noi del resto.</p>
                </div>

                <!-- Actions -->
                <div class="action-buttons">
                    <button class="btn-primary" onclick="submitCustomRecipe()">FATTO  +25pt</button>
                    <button class="btn-skip" onclick="skipCustomRecipe()">Salta (ho mangiato fuori)</button>
                </div>
            </div>
        </div>

        <!-- STATS FULL SCREEN -->
        <div id="stats-full-screen" class="stats-full-screen">
            <div class="stats-full-header">
                <button class="btn-back" onclick="closeFullStats()"> Indietro</button>
                <h2> Le tue statistiche</h2>
            </div>

            <div class="stats-tabs">
                <button class="stats-tab active" data-period="oggi" onclick="switchStatsPeriod('oggi')">Oggi</button>
                <button class="stats-tab" data-period="settimana" onclick="switchStatsPeriod('settimana')">Settimana</button>
                <button class="stats-tab" data-period="mese" onclick="switchStatsPeriod('mese')">Mese</button>
            </div>

            <div class="stats-full-content">
                <!-- TAB OGGI -->
                <div id="stats-oggi" class="stats-tab-content active">
                    <div class="stat-card-full">
                        <h3> Attivit</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Missioni completate</span>
                            <span class="stat-detail-value">1</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Ricette cucinate</span>
                            <span class="stat-detail-value">0</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Prodotti tracciati</span>
                            <span class="stat-detail-value">5</span>
                        </div>
                    </div>

                    <div class="stat-card-full">
                        <h3> Impatto</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">CO2 salvata</span>
                            <span class="stat-detail-value">0.2 kg</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Cibo non sprecato</span>
                            <span class="stat-detail-value">0.5 kg</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Equivalente in alberi</span>
                            <span class="stat-detail-value">0.01 </span>
                        </div>
                    </div>

                    <div class="stat-card-full">
                        <h3> Risparmio</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Denaro risparmiato</span>
                            <span class="stat-detail-value">5</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Prodotti usati</span>
                            <span class="stat-detail-value">3</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Valore salvato</span>
                            <span class="stat-detail-value">8</span>
                        </div>
                    </div>

                    <div class="stat-card-full">
                        <h3> Punti & Livello</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Punti guadagnati oggi</span>
                            <span class="stat-detail-value">+25 pt</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Totale punti</span>
                            <span class="stat-detail-value">25 pt</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Livello attuale</span>
                            <span class="stat-detail-value">Novizio</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Giorni di streak</span>
                            <span class="stat-detail-value"> 1</span>
                        </div>
                    </div>
                </div>

                <!-- TAB SETTIMANA -->
                <div id="stats-settimana" class="stats-tab-content">
                    <div class="stat-card-full">
                        <h3> Attivit</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Missioni completate</span>
                            <span class="stat-detail-value">7</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Ricette cucinate</span>
                            <span class="stat-detail-value">5</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Prodotti tracciati</span>
                            <span class="stat-detail-value">28</span>
                        </div>
                    </div>

                    <div class="stat-card-full">
                        <h3> Impatto</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">CO2 salvata</span>
                            <span class="stat-detail-value">1.4 kg</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Cibo non sprecato</span>
                            <span class="stat-detail-value">3.5 kg</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Equivalente in alberi</span>
                            <span class="stat-detail-value">0.07 </span>
                        </div>
                    </div>

                    <div class="stat-card-full">
                        <h3> Risparmio</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Denaro risparmiato</span>
                            <span class="stat-detail-value">35</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Prodotti usati</span>
                            <span class="stat-detail-value">21</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Valore salvato</span>
                            <span class="stat-detail-value">56</span>
                        </div>
                    </div>

                    <div class="stat-card-full">
                        <h3> Punti & Livello</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Punti guadagnati</span>
                            <span class="stat-detail-value">+175 pt</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Media giornaliera</span>
                            <span class="stat-detail-value">25 pt/giorno</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Giorni di streak</span>
                            <span class="stat-detail-value"> 7</span>
                        </div>
                    </div>
                </div>

                <!-- TAB MESE -->
                <div id="stats-mese" class="stats-tab-content">
                    <div class="stat-card-full">
                        <h3> Attivit</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Missioni completate</span>
                            <span class="stat-detail-value">30</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Ricette cucinate</span>
                            <span class="stat-detail-value">22</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Prodotti tracciati</span>
                            <span class="stat-detail-value">120</span>
                        </div>
                    </div>

                    <div class="stat-card-full">
                        <h3> Impatto</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">CO2 salvata</span>
                            <span class="stat-detail-value">6.0 kg</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Cibo non sprecato</span>
                            <span class="stat-detail-value">15 kg</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Equivalente in alberi</span>
                            <span class="stat-detail-value">0.3 </span>
                        </div>
                    </div>

                    <div class="stat-card-full">
                        <h3> Risparmio</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Denaro risparmiato</span>
                            <span class="stat-detail-value">150</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Prodotti usati</span>
                            <span class="stat-detail-value">90</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Valore salvato</span>
                            <span class="stat-detail-value">240</span>
                        </div>
                    </div>

                    <div class="stat-card-full">
                        <h3> Punti & Livello</h3>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Punti guadagnati</span>
                            <span class="stat-detail-value">+750 pt</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Media giornaliera</span>
                            <span class="stat-detail-value">25 pt/giorno</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Streak pi lungo</span>
                            <span class="stat-detail-value"> 30</span>
                        </div>
                        <div class="stat-detail-row">
                            <span class="stat-detail-label">Livello raggiunto</span>
                            <span class="stat-detail-value">Esperto</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal per Mission Photo -->
        <div class="modal" id="photoMissionModal">
            <div class="modal-content">
                <div class="modal-icon"></div>
                <div class="modal-title">Scatta & Scopri</div>
                <div class="modal-text">Scatta una foto del tuo frigo per scoprire cosa hai e ricevere suggerimenti personalizzati!</div>

                <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                    <div style="font-size: 32px; margin-bottom: 10px;"></div>
                    <div>Tocca per scattare foto</div>
                    <input type="file" id="photoInput" accept="image/*" onchange="processPhoto()">
                </div>

                <div id="photoResult" class="hidden">
                    <div class="loading"> Analizziamo la tua foto...</div>
                </div>

                <button class="btn-primary" onclick="closeModal('photoMissionModal')" style="margin-top: 15px;">
                    CHIUDI
                </button>
            </div>
        </div>

        <!-- Modal per Recipe Suggestion -->
        <div class="modal" id="recipeSuggestionModal">
            <div class="modal-content">
                <div class="modal-icon"></div>
                <div class="modal-title">Ricette Consigliate</div>
                <div class="modal-text">Perfette per usare i tuoi ingredienti prima che scadano!</div>

                <div class="recipe-grid" id="recipeGrid">
                    <div class="recipe-card" onclick="selectRecipe(this, 'caprese')">
                        <div class="recipe-title"> Insalata Caprese</div>
                        <div class="recipe-ingredients">Mozzarella, Pomodori, Basilico</div>
                    </div>
                    <div class="recipe-card" onclick="selectRecipe(this, 'pasta')">
                        <div class="recipe-title"> Pasta al Pomodoro</div>
                        <div class="recipe-ingredients">Pomodori, Pasta, Aglio</div>
                    </div>
                    <div class="recipe-card" onclick="selectRecipe(this, 'pizza')">
                        <div class="recipe-title"> Pizza Margherita</div>
                        <div class="recipe-ingredients">Mozzarella, Pomodori, Farina</div>
                    </div>
                </div>

                <button class="btn-primary" onclick="confirmRecipe()" id="confirmRecipeBtn" style="opacity: 0.5;" disabled>
                    CUCINO QUESTA! 
                </button>

                <!-- NUOVO: Opzione custom -->
                <div class="custom-option-modal">
                    <p class="divider">oppure</p>
                    <button class="btn-secondary-custom" onclick="showCustomRecipe()">
                         Ho cucinato altro
                    </button>
                </div>

                <button class="btn-secondary" onclick="closeModal('recipeSuggestionModal')" style="margin-top: 10px; width: 100%;">
                    CHIUDI
                </button>
            </div>
        </div>

        <!-- Modal per Mission Completata -->
        <div class="modal" id="missionCompleteModal">
            <div class="modal-content">
                <div class="modal-icon success-animation"></div>
                <div class="modal-title">Mission Completata!</div>
                <div class="modal-text">Ottimo lavoro! Hai guadagnato punti e mantenuto il tuo streak.</div>

                <div class="points-earned" id="pointsEarned">
                    +30 punti
                </div>

                <!-- Simulazione Ad -->
                <div class="ad-banner">
                    <button class="ad-skip" onclick="skipAd()">Salta (3s)</button>
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;"> HelloFresh</div>
                    <div style="font-size: 12px;">Ricette fresche consegnate a casa tua!</div>
                </div>

                <button class="btn-primary" onclick="closeMissionComplete()">
                    FANTASTICO!
                </button>
            </div>
        </div>

        <!-- Modal Zero Spreco -->
        <div class="modal" id="zeroWasteModal">
            <div class="modal-content">
                <div class="modal-icon"></div>
                <div class="modal-title">Zero Spreco</div>
                <div class="modal-text">Questi prodotti stanno per scadere. Come li hai usati?</div>

                <div class="food-list" style="margin: 20px 0;">
                    <div class="food-item">
                        <span class="food-emoji"></span>
                        <span>Mozzarella</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-secondary" onclick="markFood('used')"> Usato</button>
                    <button class="btn-secondary" onclick="markFood('wasted')"> Buttato</button>
                    <button class="btn-secondary" onclick="markFood('good')"> Ancora buono</button>
                </div>

                <button class="btn-primary" onclick="closeModal('zeroWasteModal')" style="margin-top: 15px;">
                    CHIUDI
                </button>
            </div>
        </div>

        <!-- ADD PRODUCT MODAL -->
        <div class="add-product-modal" id="addProductModal">
            <div class="add-product-content">
                <div class="modal-header-custom">
                    <h3 class="modal-title-custom">Aggiungi prodotto</h3>
                    <button class="btn-close-modal" onclick="closeAddProductModal()"></button>
                </div>

                <!-- Quick Picks -->
                <div class="quick-picks-section">
                    <div class="section-label">Scelte rapide:</div>
                    <div class="quick-picks-grid-modal">
                        <button class="quick-pick-btn" onclick="addQuickPick('', 'Latte')">
                            <span class="quick-pick-icon"></span>
                            Latte
                        </button>
                        <button class="quick-pick-btn" onclick="addQuickPick('', 'Uova')">
                            <span class="quick-pick-icon"></span>
                            Uova
                        </button>
                        <button class="quick-pick-btn" onclick="addQuickPick('', 'Pane')">
                            <span class="quick-pick-icon"></span>
                            Pane
                        </button>
                        <button class="quick-pick-btn" onclick="addQuickPick('', 'Pomodori')">
                            <span class="quick-pick-icon"></span>
                            Pomodori
                        </button>
                        <button class="quick-pick-btn" onclick="addQuickPick('', 'Formaggio')">
                            <span class="quick-pick-icon"></span>
                            Formaggio
                        </button>
                        <button class="quick-pick-btn" onclick="addQuickPick('', 'Carote')">
                            <span class="quick-pick-icon"></span>
                            Carote
                        </button>
                        <button class="quick-pick-btn" onclick="addQuickPick('', 'Pasta')">
                            <span class="quick-pick-icon"></span>
                            Pasta
                        </button>
                        <button class="quick-pick-btn" onclick="addQuickPick('', 'Mele')">
                            <span class="quick-pick-icon"></span>
                            Mele
                        </button>
                        <button class="quick-pick-btn" onclick="addQuickPick('', 'Broccoli')">
                            <span class="quick-pick-icon"></span>
                            Broccoli
                        </button>
                    </div>
                </div>

                <!-- Custom Input -->
                <div class="custom-input-section">
                    <div class="section-label">Oppure scrivi:</div>
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="customProductInput"
                            class="custom-product-input"
                            placeholder="Es: Yogurt, Biscotti..."
                            onkeypress="handleCustomInputEnter(event)"
                        >
                        <button class="btn-add-custom" onclick="addCustomProduct()">Aggiungi</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTEXT FULLSCREEN MODAL -->
        <div id="contextFullscreen" class="context-fullscreen">
            <div class="context-fs-header">
                <h2> PARLACI DI TE</h2>
                <button class="context-fs-close" onclick="closeContextModal()"></button>
            </div>

            <div class="context-fs-content">
                <div class="context-intro">
                    <p>Al momento assumiamo tu possa mangiare tutto e cucinare quando vuoi.</p>
                    <p style="margin-top: 12px;">Se hai restrizioni, preferenze o routine particolari, dillo qui!</p>
                </div>

                <div class="context-example">
                    Es: Sono vegetariano, cucino solo la sera, ho 2 bambini, allergico alle noci...
                </div>

                <textarea
                    id="contextTextarea"
                    class="context-textarea"
                    placeholder="Scrivi qui le tue preferenze..."
                >Sono vegetariano, cucino solo la sera, ho 2 bambini, allergico alle noci</textarea>

                <div class="context-ai-note">
                    <span></span>
                    <span>L'AI user queste info per personalizzare tutto per te!</span>
                </div>
            </div>

            <div class="context-actions">
                <button class="btn-cancel" onclick="closeContextModal()">ANNULLA</button>
                <button class="btn-save" onclick="saveContext()">SALVA</button>
            </div>
        </div>

        <!-- CONTEXT CONFIRMATION MODAL -->
        <div id="contextConfirmModal" class="context-confirm-modal">
            <div class="context-confirm-content">
                <div class="confirm-icon"></div>
                <div class="confirm-title">Contesto salvato!</div>
                <div class="confirm-subtitle">L'AI ora sa che:</div>

                <div class="confirm-list">
                    <div class="confirm-list-item"> Sei vegetariano</div>
                    <div class="confirm-list-item"> Cucini solo la sera</div>
                    <div class="confirm-list-item"> Hai 2 bambini</div>
                    <div class="confirm-list-item"> Allergico alle noci</div>
                </div>

                <div class="confirm-message">
                    I suggerimenti saranno pi adatti a te da ora! 
                </div>

                <button class="btn-primary" onclick="closeConfirmModal()">OK</button>
            </div>
        </div>

        <!-- SPESA SMART SCREEN -->
        <div id="spesaSmartScreen" class="spesa-smart-screen">
            <div class="spesa-smart-header">
                <h2> SPESA SMART</h2>
                <button class="spesa-smart-close" onclick="closeSpesaSmart()"></button>
            </div>

            <div class="spesa-smart-content" id="spesaSmartContent">
                <!-- Step 1: Upload -->
                <div id="uploadStep">
                    <p class="upload-intro">Carica lo scontrino della spesa</p>

                    <div class="upload-area">
                        <div class="upload-icon"></div>
                        <div class="upload-text">Scatta o carica foto</div>
                        <div class="upload-text">dello scontrino</div>
                    </div>

                    <button class="btn-upload" onclick="uploadReceipt()">CARICA FOTO</button>
                </div>

                <!-- Step 2: Receipt Display (hidden initially) -->
                <div id="receiptStep" style="display: none;">
                    <div class="receipt-container">
                        <div class="receipt-header">ESSELUNGA</div>
                        <div class="receipt-address">Via Roma 123, Milano</div>
                        <div class="receipt-date">19/12/2024 - 14:32</div>

                        <div class="receipt-divider"></div>

                        <div class="receipt-item">
                            <span>MUTTI PASSATA 500G</span>
                            <span>1.89</span>
                        </div>
                        <div class="receipt-item">
                            <span>DATTERINI GIALLI</span>
                            <span>2.49</span>
                        </div>
                        <div class="receipt-item">
                            <span>BARILLA PENNE 500G</span>
                            <span>1.19</span>
                        </div>
                        <div class="receipt-item">
                            <span>GRANA PADANO 200G</span>
                            <span>3.99</span>
                        </div>
                        <div class="receipt-item">
                            <span>COCA COLA 1.5L</span>
                            <span>1.49</span>
                        </div>

                        <div class="receipt-divider"></div>

                        <div class="receipt-total">
                            <span>TOTALE</span>
                            <span>11.05</span>
                        </div>

                        <div class="receipt-footer">Grazie per la visita!</div>
                    </div>
                </div>

                <!-- Step 3: Processing (hidden initially) -->
                <div id="processingStep" style="display: none;">
                    <div class="processing-container">
                        <div class="processing-title">
                            <span></span>
                            <span>Sto elaborando...</span>
                        </div>

                        <div class="spinner"></div>

                        <div class="processing-steps">
                            <div class="processing-step completed" id="step1">
                                 Riconoscimento prodotti brandizzati
                            </div>
                            <div class="processing-step loading" id="step2">
                                 Mapping prodotti generici...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Result (hidden initially) -->
                <div id="resultStep" style="display: none;">
                    <div class="result-container">
                        <div class="result-icon"></div>
                        <div class="result-title">COMPLETATO!</div>
                        <div class="result-subtitle">5 prodotti aggiunti:</div>

                        <div class="result-products">
                            <div class="result-product-item">
                                <span></span>
                                <span>Passata di pomodoro</span>
                            </div>
                            <div class="result-product-item">
                                <span></span>
                                <span>Pomodorini</span>
                            </div>
                            <div class="result-product-item">
                                <span></span>
                                <span>Pasta</span>
                            </div>
                            <div class="result-product-item">
                                <span></span>
                                <span>Parmigiano</span>
                            </div>
                            <div class="result-product-item">
                                <span></span>
                                <span>Coca Cola</span>
                            </div>
                        </div>

                        <div class="result-points">+25 punti</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PLACEHOLDER SCREENS -->
        <div class="placeholder-screen hidden" id="placeholder-scatta">
            <div class="placeholder-content">
                <div class="placeholder-icon"></div>
                <h2 class="placeholder-title">Scatta & Scopri</h2>
                <p class="placeholder-text">Questa mission sar disponibile presto!</p>
                <p class="placeholder-desc">Scatta una foto del tuo frigo e scopri cosa puoi cucinare.</p>
                <button class="btn-primary" onclick="goBackHome()"> Torna alla Home</button>
            </div>
        </div>

        <div class="placeholder-screen hidden" id="placeholder-spesa">
            <div class="placeholder-content">
                <div class="placeholder-icon"></div>
                <h2 class="placeholder-title">Spesa Smart</h2>
                <p class="placeholder-text">Questa mission sar disponibile presto!</p>
                <p class="placeholder-desc">Carica lo scontrino della spesa e traccia i tuoi acquisti.</p>
                <button class="btn-primary" onclick="goBackHome()"> Torna alla Home</button>
            </div>
        </div>

        <div class="placeholder-screen hidden" id="placeholder-zero">
            <div class="placeholder-content">
                <div class="placeholder-icon"></div>
                <h2 class="placeholder-title">Zero Spreco</h2>
                <p class="placeholder-text">Questa mission sar disponibile presto!</p>
                <p class="placeholder-desc">Verifica cosa hai usato e cosa  andato sprecato.</p>
                <button class="btn-primary" onclick="goBackHome()"> Torna alla Home</button>
            </div>
        </div>

        <div class="placeholder-screen hidden" id="placeholder-frigo">
            <div class="placeholder-content">
                <div class="placeholder-icon"></div>
                <h2 class="placeholder-title">Frigo Check</h2>
                <p class="placeholder-text">Questa mission sar disponibile presto!</p>
                <p class="placeholder-desc">Controlla velocemente cosa hai in frigo.</p>
                <button class="btn-primary" onclick="goBackHome()"> Torna alla Home</button>
            </div>
        </div>
    </div>

    <script>
        let currentScreen = 1;
        let selectedChoice = null;

        function nextScreen(screenNumber) {
            // Hide current screen
            document.getElementById(`screen${currentScreen}`).classList.remove('active');
            
            // Show next screen
            currentScreen = screenNumber;
            document.getElementById(`screen${screenNumber}`).classList.add('active');
        }

        function selectChoice(choice) {
            selectedChoice = choice;

            if (choice === 'photo') {
                nextScreen(4);
            } else if (choice === 'receipt') {
                // Open Spesa Smart screen with onboarding context
                openSpesaSmart('onboarding');
            } else if (choice === 'voice') {
                alert(' Input vocale - Coming soon!\n\nPer ora prova con la foto del frigo ');
            }
        }

        function capturePhoto() {
            // Simulate photo capture
            const cameraView = document.getElementById('cameraView');
            cameraView.innerHTML = '<div style="font-size: 48px;"></div><div>Foto scattata!</div>';
            
            // Show processing screen
            setTimeout(() => {
                nextScreen('4b');
                
                // Show results after "processing"
                setTimeout(() => {
                    nextScreen(5);
                }, 2500);
            }, 1000);
        }

        function createAccount(method) {
            // Simulate account creation
            alert(` Account creato con ${method === 'email' ? 'Email' : method === 'apple' ? 'Apple' : 'Google'}!\n\nBenvenuto in Foodybank! `);
            nextScreen(7);
        }

        function enableNotifications() {
            // Simulate notification permission request
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        alert(' Notifiche attivate!\n\nTi ricorderemo la tua mission quotidiana. ');
                    }
                    showMainApp();
                });
            } else {
                alert(' Notifiche attivate!\n\nTi ricorderemo la tua mission quotidiana. ');
                showMainApp();
            }
        }

        function showMainApp() {
            // Hide onboarding
            document.getElementById('screen7').classList.remove('active');
            
            // Show main app with animation
            const mainApp = document.getElementById('mainApp');
            mainApp.style.opacity = '0';
            mainApp.classList.add('active');
            
            setTimeout(() => {
                mainApp.style.transition = 'opacity 0.5s';
                mainApp.style.opacity = '1';
            }, 100);

            // Celebration
            setTimeout(() => {
                alert(' Benvenuto in Foodybank!\n\nHai completato il tuo primo setup.\nOra completa la tua prima mission quotidiana! ');
            }, 1000);
        }

        // Main App Functions
        let appState = {
            streak: 1,
            points: 25,
            level: "Novizio",
            selectedRecipe: null,
            missionCompleted: false
        };

        function updateUI() {
            const streakEl = document.getElementById('streakCount');
            const pointsEl = document.getElementById('pointsCount');
            const levelEl = document.getElementById('userLevel');
            if (streakEl) streakEl.textContent = appState.streak;
            if (pointsEl) pointsEl.textContent = appState.points;
            if (levelEl) levelEl.textContent = appState.level;
        }

        function startMission() {
            const missions = ['photo', 'recipe', 'zeroWaste'];
            const randomMission = missions[Math.floor(Math.random() * missions.length)];

            switch(randomMission) {
                case 'photo':
                    showModal('photoMissionModal');
                    break;
                case 'recipe':
                    showModal('recipeSuggestionModal');
                    break;
                case 'zeroWaste':
                    showModal('zeroWasteModal');
                    break;
            }
        }

        function suggestRecipe() {
            showModal('recipeSuggestionModal');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function processPhoto() {
            const fileInput = document.getElementById('photoInput');
            if (fileInput.files.length > 0) {
                document.getElementById('photoResult').classList.remove('hidden');

                setTimeout(() => {
                    document.getElementById('photoResult').innerHTML = `
                        <div style="color: #4CAF50; font-weight: bold; margin-bottom: 10px;">
                             Foto elaborata con successo!
                        </div>
                        <div style="font-size: 14px; color: #666;">
                            Trovati: Mozzarella, Pomodori, Latte, Uova, Yogurt
                        </div>
                    `;

                    setTimeout(() => {
                        completeMission(25);
                    }, 1500);
                }, 2000);
            }
        }

        function selectRecipe(element, recipeId) {
            document.querySelectorAll('.recipe-card').forEach(card => {
                card.classList.remove('selected');
            });

            element.classList.add('selected');
            appState.selectedRecipe = recipeId;

            const btn = document.getElementById('confirmRecipeBtn');
            btn.disabled = false;
            btn.style.opacity = '1';
        }

        function confirmRecipe() {
            if (appState.selectedRecipe) {
                closeModal('recipeSuggestionModal');
                setTimeout(() => {
                    completeMission(35);
                }, 500);
            }
        }

        function markFood(action) {
            let points = 0;

            switch(action) {
                case 'used':
                    points = 40;
                    break;
                case 'wasted':
                    points = 10;
                    break;
                case 'good':
                    points = 20;
                    break;
            }

            closeModal('zeroWasteModal');
            setTimeout(() => {
                completeMission(points);
            }, 500);
        }

        function completeMission(points) {
            closeModal('photoMissionModal');
            closeModal('recipeSuggestionModal');
            closeModal('zeroWasteModal');

            appState.points += points;
            appState.missionCompleted = true;

            document.getElementById('pointsEarned').textContent = `+${points} punti`;
            showModal('missionCompleteModal');

            updateUI();

            setTimeout(() => {
                const skipBtn = document.querySelector('.ad-skip');
                if (skipBtn) {
                    skipBtn.textContent = 'Salta';
                    skipBtn.style.background = '#4CAF50';
                }
            }, 3000);
        }

        function skipAd() {
            const adBanner = document.querySelector('.ad-banner');
            if (adBanner) adBanner.style.display = 'none';
        }

        function closeMissionComplete() {
            closeModal('missionCompleteModal');

            // Torna alla Home screen
            navigateTo('home');

            // Aggiorna il box mission in Home
            const missionBox = document.querySelector('.mission-suggested-main');
            if (missionBox) {
                missionBox.innerHTML = `
                    <div class="badge-main"> COMPLETATA</div>
                    <div class="emoji-large"></div>
                    <h2 class="mission-title-main">Mission Completata!</h2>
                    <p class="mission-desc-main">Ottimo lavoro!<br>Torna domani per una nuova sfida</p>
                    <button class="btn-primary-large" disabled style="opacity: 0.5; cursor: not-allowed;">
                        COMPLETATA PER OGGI
                    </button>
                `;
            }
        }

        // HYBRID MODEL - Navigation & Mock Data

        // Mock Data
        const mockData = {
            user: {
                streak: 1,
                points: 30,
                level: "Novizio"
            },

            suggestedMission: {
                type: "chef_di_oggi",
                title: "Chef di oggi",
                emoji: "",
                points: 30,
                bonus: 10
            },

            productsToUse: [
                { name: "Mozzarella", emoji: "" },
                { name: "Pomodori", emoji: "" },
                { name: "Latte", emoji: "" }
            ],

            otherMissions: [
                { id: "scatta", title: "Scatta & Scopri", emoji: "", points: 20 },
                { id: "spesa", title: "Spesa Smart", emoji: "", points: 25 },
                { id: "zero", title: "Zero Spreco", emoji: "", points: 10 },
                { id: "frigo", title: "Frigo Check", emoji: "", points: 5 }
            ],

            todayStats: {
                co2: "150g",
                money: "8"
            }
        };

        // Navigation Functions
        function startChefMission() {
            // Apri SOLO il modal Chef (ricette)
            showModal('recipeSuggestionModal');
        }

        function openPlaceholder(missionId) {
            // Nascondi main app
            document.getElementById('mainApp').style.display = 'none';

            // Mostra placeholder corrispondente
            const placeholderEl = document.getElementById(`placeholder-${missionId}`);
            if (placeholderEl) {
                placeholderEl.classList.remove('hidden');
            }
        }

        function goBackHome() {
            // Nascondi tutti i placeholder
            document.querySelectorAll('.placeholder-screen').forEach(el => {
                el.classList.add('hidden');
            });

            // Mostra main app
            document.getElementById('mainApp').style.display = 'block';
        }

        // NEW: Navigation between screens
        function navigateTo(screenName) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });

            // Show selected screen
            const targetScreen = document.getElementById(screenName + '-screen');
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
            }

            // Update tab bar active state
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            const activeTab = document.querySelector(`[data-tab="${screenName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
        }

        // NEW: Show custom recipe screen
        function showCustomRecipe() {
            // Close modal if open
            closeModal('recipeSuggestionModal');

            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });

            // Show custom recipe screen
            document.getElementById('custom-recipe-screen').classList.remove('hidden');
        }

        // NEW: Go back to chef mission (from custom recipe)
        function goBackToChef() {
            document.getElementById('custom-recipe-screen').classList.add('hidden');
            // Reopen recipe modal
            showModal('recipeSuggestionModal');
        }

        // NEW: Quick pick selection
        function selectQuickRecipe(recipeName) {
            console.log('Quick pick:', recipeName);
            completeCustomRecipe(recipeName);
        }

        // NEW: Submit custom input
        function submitCustomRecipe() {
            const input = document.getElementById('custom-recipe-input');
            const recipeText = input.value.trim();

            if (recipeText === '') {
                alert('Scrivi cosa hai cucinato!');
                return;
            }

            console.log('Custom recipe:', recipeText);
            completeCustomRecipe(recipeText);
        }

        // NEW: Skip custom recipe (ate out)
        function skipCustomRecipe() {
            console.log('User skipped custom recipe');

            // Still complete mission (no penalty)
            document.getElementById('custom-recipe-screen').classList.add('hidden');
            document.getElementById('pointsEarned').textContent = '+25 punti';
            showModal('missionCompleteModal');

            appState.points += 25;
            updateUI();
        }

        // NEW: Complete custom recipe flow
        function completeCustomRecipe(recipeText) {
            console.log('Completing custom recipe:', recipeText);

            // Hide custom screen
            document.getElementById('custom-recipe-screen').classList.add('hidden');

            // Show reward
            document.getElementById('pointsEarned').textContent = '+25 punti';
            showModal('missionCompleteModal');

            // Update points
            appState.points += 25;
            updateUI();

            // Clear input for next time
            document.getElementById('custom-recipe-input').value = '';
        }

        // NEW: Show placeholder for non-implemented missions
        function showPlaceholder(missionType) {
            const placeholderEl = document.getElementById(`placeholder-${missionType}`);
            if (placeholderEl) {
                placeholderEl.classList.remove('hidden');
            }
        }

        // NEW: Show full stats screen
        function showFullStats() {
            document.getElementById('stats-full-screen').classList.add('active');
        }

        // NEW: Close full stats screen
        function closeFullStats() {
            document.getElementById('stats-full-screen').classList.remove('active');
        }

        // NEW: Switch stats period tabs
        function switchStatsPeriod(period) {
            // Remove active from all tabs
            document.querySelectorAll('.stats-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Add active to selected tab
            const selectedTab = document.querySelector(`[data-period="${period}"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Hide all tab contents
            document.querySelectorAll('.stats-tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Show selected tab content
            const selectedContent = document.getElementById(`stats-${period}`);
            if (selectedContent) {
                selectedContent.classList.add('active');
            }
        }

        // NEW: Toggle shopping item checkbox
        function toggleShoppingItem(checkbox) {
            const item = checkbox.closest('.shopping-item');
            if (checkbox.checked) {
                item.classList.add('checked');
            } else {
                item.classList.remove('checked');
            }
        }

        // NEW: Open Spesa Smart mission
        function openSpesaSmartMission() {
            // Open Spesa Smart screen with mission context
            openSpesaSmart('mission');
        }

        // NEW: Open Add Product Modal
        function openAddProductModal() {
            document.getElementById('addProductModal').classList.add('active');
            // Clear input
            document.getElementById('customProductInput').value = '';
        }

        // NEW: Close Add Product Modal
        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('active');
        }

        // NEW: Add product from quick pick
        function addQuickPick(icon, name) {
            addProductToList(icon, name, 'Aggiunto manualmente');
            closeAddProductModal();
        }

        // NEW: Add custom product
        function addCustomProduct() {
            const input = document.getElementById('customProductInput');
            const productName = input.value.trim();

            if (productName === '') {
                alert('Scrivi il nome del prodotto');
                return;
            }

            // Auto-detect emoji or use generic one
            const emoji = '';
            addProductToList(emoji, productName, 'Aggiunto manualmente');
            closeAddProductModal();
        }

        // NEW: Handle Enter key in custom input
        function handleCustomInputEnter(event) {
            if (event.key === 'Enter') {
                addCustomProduct();
            }
        }

        // NEW: Add product to shopping list
        function addProductToList(icon, name, note) {
            const shoppingList = document.querySelector('.shopping-list');
            const addButton = document.querySelector('.add-product-btn');

            // Create new product item
            const newItem = document.createElement('div');
            newItem.className = 'shopping-item';
            newItem.innerHTML = `
                <input type="checkbox" class="shopping-checkbox" onchange="toggleShoppingItem(this)">
                <div class="shopping-item-content">
                    <div class="shopping-item-name">${icon} ${name}</div>
                    <div class="shopping-item-note">${note}</div>
                </div>
                <button class="btn-remove-item" onclick="removeFromShoppingList(this)"></button>
            `;

            // Insert before the add button
            shoppingList.insertBefore(newItem, addButton);
        }

        // NEW: Remove product from shopping list
        function removeFromShoppingList(button) {
            const item = button.closest('.shopping-item');
            if (item) {
                // Add fade out animation
                item.style.transition = 'opacity 0.3s';
                item.style.opacity = '0';

                setTimeout(() => {
                    item.remove();
                }, 300);
            }
        }

        // NEW: Open Zero Spreco modal for specific product
        function openZeroSprecoForProduct(productName, productIcon) {
            // Update modal content with specific product
            const modalContent = document.querySelector('#zeroWasteModal .food-list');
            if (modalContent) {
                modalContent.innerHTML = `
                    <div class="food-item">
                        <span class="food-emoji">${productIcon}</span>
                        <span>${productName}</span>
                    </div>
                `;
            }

            // Open the modal
            showModal('zeroWasteModal');
        }

        // PROFILO - Context Management Functions

        // Open context modal
        function openContextModal() {
            document.getElementById('contextFullscreen').classList.add('active');
        }

        // Close context modal
        function closeContextModal() {
            document.getElementById('contextFullscreen').classList.remove('active');
        }

        // Save context and show confirmation
        function saveContext() {
            // Close fullscreen modal
            closeContextModal();

            // Show confirmation modal
            document.getElementById('contextConfirmModal').classList.add('active');

            // Update context card after confirmation (will be triggered when closing confirm modal)
        }

        // Close confirmation modal and update context card
        function closeConfirmModal() {
            document.getElementById('contextConfirmModal').classList.remove('active');

            // Update context card to show saved context
            const contextCard = document.getElementById('contextCard');
            contextCard.className = 'context-card'; // Remove 'default' class
            contextCard.innerHTML = `
                <div class="context-header">
                     IL TUO CONTESTO
                </div>

                <div class="context-list">
                    <div class="context-item"> Dieta: Vegetariano</div>
                    <div class="context-item"> Allergie: Noci</div>
                    <div class="context-item"> Routine: Cucini solo la sera</div>
                    <div class="context-item"> Famiglia: 2 bambini</div>
                </div>

                <button class="btn-customize" onclick="openContextModal()" style="animation: none;">
                     MODIFICA
                </button>

                <div class="context-footer">
                    Tutto OK? Puoi sempre modificare qui!
                </div>
            `;
        }

        // SPESA SMART - Receipt Processing Functions

        let spesaSmartContext = null; // 'onboarding' or 'mission'

        // Open Spesa Smart screen
        function openSpesaSmart(context) {
            spesaSmartContext = context;

            // Reset to upload step
            document.getElementById('uploadStep').style.display = 'block';
            document.getElementById('receiptStep').style.display = 'none';
            document.getElementById('processingStep').style.display = 'none';
            document.getElementById('resultStep').style.display = 'none';

            // Show screen
            document.getElementById('spesaSmartScreen').classList.add('active');
        }

        // Close Spesa Smart screen
        function closeSpesaSmart() {
            document.getElementById('spesaSmartScreen').classList.remove('active');
            spesaSmartContext = null;
        }

        // Upload receipt (step 1  step 2)
        function uploadReceipt() {
            // Hide upload step, show receipt
            document.getElementById('uploadStep').style.display = 'none';
            document.getElementById('receiptStep').style.display = 'block';

            // Auto-start processing after showing receipt (3 sec)
            setTimeout(() => {
                startProcessing();
            }, 3000);
        }

        // Start processing (step 2  step 3)
        function startProcessing() {
            // Hide receipt, show processing
            document.getElementById('receiptStep').style.display = 'none';
            document.getElementById('processingStep').style.display = 'block';

            // Reset processing steps
            document.getElementById('step2').className = 'processing-step loading';
            document.getElementById('step2').textContent = ' Mapping prodotti generici...';

            // After 1 second, complete step 2
            setTimeout(() => {
                document.getElementById('step2').className = 'processing-step completed';
                document.getElementById('step2').textContent = ' Mapping prodotti generici';

                // After another second, show result
                setTimeout(() => {
                    showReceiptResult();
                }, 1000);
            }, 1000);
        }

        // Show result (step 3  step 4)
        function showReceiptResult() {
            // Hide processing, show result
            document.getElementById('processingStep').style.display = 'none';
            document.getElementById('resultStep').style.display = 'block';

            // Update "Da usare prima" in Home
            updateDaUsarePrima();

            // After 2 seconds, always go to Home
            setTimeout(() => {
                closeSpesaSmart();

                // If we're in onboarding, hide all onboarding screens first
                if (spesaSmartContext === 'onboarding') {
                    document.querySelectorAll('.onboarding-screen').forEach(screen => {
                        screen.classList.remove('active');
                    });
                    document.querySelector('.container').style.display = 'none';
                }

                // Navigate to Home
                navigateTo('home');
            }, 2000);
        }

        // Update "Da usare prima" section in Home with receipt products
        function updateDaUsarePrima() {
            const productsPills = document.querySelector('.products-pills');
            if (productsPills) {
                productsPills.innerHTML = `
                    <span class="product-pill">
                         Passata di pomodoro
                        <button class="btn-remove-pill" onclick="openZeroSprecoForProduct('Passata di pomodoro', '')"></button>
                    </span>
                    <span class="product-pill">
                         Pomodorini
                        <button class="btn-remove-pill" onclick="openZeroSprecoForProduct('Pomodorini', '')"></button>
                    </span>
                    <span class="product-pill">
                         Pasta
                        <button class="btn-remove-pill" onclick="openZeroSprecoForProduct('Pasta', '')"></button>
                    </span>
                    <span class="product-pill">
                         Parmigiano
                        <button class="btn-remove-pill" onclick="openZeroSprecoForProduct('Parmigiano', '')"></button>
                    </span>
                    <span class="product-pill">
                         Coca Cola
                        <button class="btn-remove-pill" onclick="openZeroSprecoForProduct('Coca Cola', '')"></button>
                    </span>
                `;
            }
        }

        // Easter egg - tap logo 3 times
        let logoTaps = 0;
        document.addEventListener('DOMContentLoaded', function() {
            const headers = document.querySelectorAll('.onboarding-icon');
            headers.forEach(header => {
                header.addEventListener('click', function() {
                    logoTaps++;
                    if (logoTaps === 3) {
                        alert(" Easter Egg!\n\n Onboarding Prototype v1.0\n Built for testing\n Zero maintenance, maximum value!");
                        logoTaps = 0;
                    }
                    setTimeout(() => { logoTaps = 0; }, 2000);
                });
            });
        });
    </script>
</body>
</html>